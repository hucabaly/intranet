function filterAnalyze(t){$(".ketquaapply").hide(),$("#danhsachduan tbody").html(""),$("#duoi3sao tbody").html("");var a=$("input[name=tieuchi]:checked").attr("id"),e="";$("input[type=checkbox][name=project_type]:checked").each(function(){""==e?e=$(this).val():e+=","+$(this).val()});var s="";if($("input[class=team-tree-checkbox]:checked").each(function(){""==s?s=$(this).attr("data-id"):s+=","+$(this).attr("data-id")}),""==e)return""==s?($("#modal-warning").modal("show"),$("#modal-warning .modal-body").html("Chưa chọn loại dự án và team")):($("#modal-warning").modal("show"),$("#modal-warning .modal-body").html("Chưa chọn loại dự án")),!1;if(""==s)return $("#modal-warning").modal("show"),$("#modal-warning .modal-body").html("Chưa chọn team"),!1;var d=$(".ui-rangeSlider-leftLabel .ui-rangeSlider-label-value").text(),i=$(".ui-rangeSlider-rightLabel .ui-rangeSlider-label-value").text();$(".apply-click-modal").show(),$.ajax({url:baseUrl+"/css/filter_analyze",type:"post",data:{_token:t,startDate:d,endDate:i,projectTypeIds:e,teamIds:s,criteriaType:a}}).done(function(t){$(".apply-click-modal").hide(),$("div.theotieuchi").html(t),$(".tbl-criteria").hide(),$(".no-result").hide(),$(".no-result-"+a).show(),$(document).trigger("icheck"),$("#startDate_val").val(d),$("#endDate_val").val(i),$("#teamIds_val").val(s),$("#projectTypeIds_val").val(e);var n=$("table[data-id="+a+"] tbody");n.parent().show(),fixScroll(n)}).fail(function(){alert("Ajax failed to fetch data")})}function fixScroll(t){if("undefined"!=typeof t.get(0)){var a=t.height(),e=t.get(0).scrollHeight;e>a?t.parent().find("thead").css("width","98%"):t.parent().find("thead").css("width","100%")}}function apply(t){var a=$("input[name=tieuchi]:checked").attr("id"),e="",s=getCriteriaChecked();if($("input[class="+s+"]:checked").each(function(){""==e?"checkQuestionItem"==s?$(this).attr("data-questionid")&&(e=$(this).attr("data-questionid")):e=$(this).attr("data-id"):"checkQuestionItem"==s?$(this).attr("data-questionid")&&(e+=","+$(this).attr("data-questionid")):e+=","+$(this).attr("data-id")}),""==e)return $("#modal-warning").modal("show"),$("#modal-warning .modal-body").html("Phải chọn ít nhất một dòng ở bảng tiêu chí."),!1;var d=$("#teamIds_val").val(),i=$("#projectTypeIds_val").val(),n=$("#startDate_val").val(),o=$("#endDate_val").val();$(".apply-click-modal").show(),$.ajax({url:baseUrl+"/css/apply_analyze",type:"post",data:{_token:t,startDate:n,endDate:o,criteriaIds:e,teamIds:d,projectTypeIds:i,criteriaType:a}}).done(function(t){$("#criteriaIds_val").val(e),$("#criteriaType_val").val(a),$(".apply-click-modal").hide(),$(".ketquaapply").show(),"tcQuestion"==a?($(".box-select-question").show(),$(".box-select-question #question-choose").html(t.htmlQuestionList),removeEmptyCate()):($(".box-select-question").hide(),$(".box-select-question #question-choose").html("")),$("html, body").animate({scrollTop:$(".ketquaapply").offset().top},100);for(var s=t.cssResultPaginate.cssResultdata.data.length,d="",i=0;i<s;i++)d+="<tr>",d+="<td>"+t.cssResultPaginate.cssResultdata.data[i].stt+"</td>",d+="<td>"+t.cssResultPaginate.cssResultdata.data[i].project_name+"</td>",d+="<td>"+t.cssResultPaginate.cssResultdata.data[i].teamName+"</td>",d+="<td>"+t.cssResultPaginate.cssResultdata.data[i].pmName+"</td>",d+="<td>"+t.cssResultPaginate.cssResultdata.data[i].css_end_date+"</td>",d+="<td>"+t.cssResultPaginate.cssResultdata.data[i].css_result_created_at+"</td>",d+="<td>"+t.cssResultPaginate.cssResultdata.data[i].point+"</td>",d+="</tr>";$("#danhsachduan tbody").html(d),$("#danhsachduan").parent().find(".pagination").html(t.cssResultPaginate.paginationRender);var n=[];$.each(t.allResultChart,function(t,a){n.push({x:new Date(a.date),y:a.point})});var o=new CanvasJS.Chart("chartAll",{animationEnabled:!0,theme:"theme1",axisX:{valueFormatString:"D/M/YY"},axisY:{},data:[{type:"line",name:"Điểm CSS",showInLegend:!0,xValueFormatString:"DD/MM/YYYY",dataPoints:n}]});o.render();var l=[];$.each(t.compareChart,function(t,a){var e=[];$.each(a.data,function(t,a){e.push({x:new Date(a.date),y:a.point})}),l.push({type:"line",name:a.name,showInLegend:!0,xValueFormatString:"DD/MM/YYYY",dataPoints:e})});var c=new CanvasJS.Chart("chartFilter",{animationEnabled:!0,theme:"theme1",axisX:{valueFormatString:"D/M/YY"},axisY:{},data:l});if(c.render(),"tcQuestion"!=a){var s=t.lessThreeStar.cssResultdata.length;if(d="",s>0){for(var i=0;i<s;i++)d+="<tr>",d+="<td>"+t.lessThreeStar.cssResultdata[i].no+"</td>",d+="<td>"+t.lessThreeStar.cssResultdata[i].projectName+"</td>",d+="<td>"+t.lessThreeStar.cssResultdata[i].questionName+"</td>",d+="<td>"+t.lessThreeStar.cssResultdata[i].stars+"</td>",d+="<td>"+t.lessThreeStar.cssResultdata[i].comment+"</td>",d+="<td>"+t.lessThreeStar.cssResultdata[i].makeDateCss+"</td>",d+="<td>"+t.lessThreeStar.cssResultdata[i].cssPoint+"</td>",d+="</tr>";$("#duoi3sao tbody").html(d),$("#duoi3sao").parent().find(".pagination").html(t.lessThreeStar.paginationRender)}else $("#duoi3sao tbody").html(noResult),$("#duoi3sao").parent().find(".pagination").html("");if(s=t.proposes.cssResultdata.length,d="",s>0){for(var i=0;i<s;i++)d+="<tr>",d+="<td>"+t.proposes.cssResultdata[i].no+"</td>",d+="<td>"+t.proposes.cssResultdata[i].projectName+"</td>",d+="<td>"+t.proposes.cssResultdata[i].customerComment+"</td>",d+="<td>"+t.proposes.cssResultdata[i].makeDateCss+"</td>",d+="<td>"+t.proposes.cssResultdata[i].cssPoint+"</td>",d+="</tr>";$("#danhsachdexuat tbody").html(d),$("#danhsachdexuat").parent().find(".pagination").html(t.proposes.paginationRender)}else $("#danhsachdexuat").parent().find(".pagination").html(""),$("#danhsachdexuat tbody").html(noResult);$("#duoi3sao thead th").attr("data-type","all"),$("#danhsachdexuat thead th").attr("data-type","all")}else $("#duoi3sao tbody").html(""),$("#duoi3sao").parent().find(".pagination").html(""),$("#danhsachdexuat tbody").html(""),$("#danhsachdexuat").parent().find(".pagination").html(""),$("#duoi3sao thead th").attr("data-type","question"),$("#danhsachdexuat thead th").attr("data-type","question");$("#cssResultIds").val(t.strResultIds)}).fail(function(){alert("Ajax failed to fetch data")})}function getCriteriaChecked(){var t=$("input[name=tieuchi]:checked").attr("id");return"tcProjectType"==t?"checkProjectTypeItem":"tcTeam"==t?"checkTeamItem":"tcPm"==t?"checkPmItem":"tcBrse"==t?"checkBrseItem":"tcCustomer"==t?"checkCustomerItem":"tcSale"==t?"checkSaleItem":"tcQuestion"==t?"checkQuestionItem":void 0}function showAnalyzeListProject(t,a,e,s){var d=$("#startDate_val").val(),i=$("#endDate_val").val(),n=$("#criteriaIds_val").val(),o=$("#teamIds_val").val(),l=$("#projectTypeIds_val").val(),c=getCriteriaType($("#criteriaType_val").val());$("#danhsachduan tbody").html(strLoading),$.ajax({url:baseUrl+"css/show_analyze_list_project/"+n+"/"+o+"/"+l+"/"+d+"/"+i+"/"+c+"/"+t+"/"+e+"/"+s,type:"post",data:{_token:a}}).done(function(t){for(var a=t.cssResultdata.data.length,e="",s=0;s<a;s++)e+="<tr>",e+="<td>"+t.cssResultdata.data[s].stt+"</td>",e+="<td>"+t.cssResultdata.data[s].project_name+"</td>",e+="<td>"+t.cssResultdata.data[s].teamName+"</td>",e+="<td>"+t.cssResultdata.data[s].pmName+"</td>",e+="<td>"+t.cssResultdata.data[s].css_end_date+"</td>",e+="<td>"+t.cssResultdata.data[s].css_result_created_at+"</td>",e+="<td>"+t.cssResultdata.data[s].point+"</td>",e+="</tr>";$("#danhsachduan tbody").html(e),$("#danhsachduan").parent().find(".pagination").html(t.paginationRender)}).fail(function(){alert("Ajax failed to fetch data")})}function getListLessThreeStar(t,a,e,s,d){$("#duoi3sao tbody").html(strLoading),$.ajax({url:baseUrl+"css/get_list_less_three_star/"+e+"/"+t+"/"+s+"/"+d,type:"post",data:{_token:a}}).done(function(t){var a=t.cssResultdata.length;if(html="",a>0){for(var e=0;e<a;e++)html+="<tr>",html+="<td>"+t.cssResultdata[e].no+"</td>",html+="<td>"+t.cssResultdata[e].projectName+"</td>",html+="<td>"+t.cssResultdata[e].questionName+"</td>",html+="<td>"+t.cssResultdata[e].stars+"</td>",html+="<td>"+t.cssResultdata[e].comment+"</td>",html+="<td>"+t.cssResultdata[e].makeDateCss+"</td>",html+="<td>"+t.cssResultdata[e].cssPoint+"</td>",html+="</tr>";$("#duoi3sao tbody").html(html),$("#duoi3sao").parent().find(".pagination").html(t.paginationRender)}else $("#duoi3sao tbody").html(noResult)}).fail(function(){alert("Ajax failed to fetch data")})}function getProposes(t,a,e,s,d){$("#danhsachdexuat tbody").html(strLoading),$.ajax({url:baseUrl+"css/get_proposes/"+e+"/"+t+"/"+s+"/"+d,type:"post",data:{_token:a}}).done(function(t){var a=t.cssResultdata.length;html="";for(var e=0;e<a;e++)html+="<tr>",html+="<td>"+t.cssResultdata[e].no+"</td>",html+="<td>"+t.cssResultdata[e].projectName+"</td>",html+="<td>"+t.cssResultdata[e].customerComment+"</td>",html+="<td>"+t.cssResultdata[e].makeDateCss+"</td>",html+="<td>"+t.cssResultdata[e].cssPoint+"</td>",html+="</tr>";$("#danhsachdexuat tbody").html(html),$("#danhsachdexuat").parent().find(".pagination").html(t.paginationRender)}).fail(function(){alert("Ajax failed to fetch data")})}function getListLessThreeStarByQuestion(t,a,e,s,d,i){$("#duoi3sao tbody").html(strLoading),$.ajax({url:baseUrl+"css/get_list_less_three_star_question/"+t+"/"+s+"/"+a+"/"+d+"/"+i,type:"post",data:{_token:e}}).done(function(t){var a=t.cssResultdata.length;if(html="",a>0){for(var e=0;e<a;e++)html+="<tr>",html+="<td>"+t.cssResultdata[e].no+"</td>",html+="<td>"+t.cssResultdata[e].projectName+"</td>",html+="<td>"+t.cssResultdata[e].questionName+"</td>",html+="<td>"+t.cssResultdata[e].stars+"</td>",html+="<td>"+t.cssResultdata[e].comment+"</td>",html+="<td>"+t.cssResultdata[e].makeDateCss+"</td>",html+="<td>"+t.cssResultdata[e].cssPoint+"</td>",html+="</tr>";$("#duoi3sao tbody").html(html),$("#duoi3sao").parent().find(".pagination").html(t.paginationRender)}else $("#duoi3sao tbody").html(noResult),$("#duoi3sao").parent().find(".pagination").html("")}).fail(function(){alert("Ajax failed to fetch data")})}function getProposesQuestion(t,a,e,s,d,i){$("#danhsachdexuat tbody").html(strLoading),$.ajax({url:baseUrl+"css/get_proposes_question/"+t+"/"+s+"/"+a+"/"+d+"/"+i,type:"post",data:{_token:e}}).done(function(t){var a=t.cssResultdata.length;if(html="",a>0){for(var e=0;e<a;e++)html+="<tr>",html+="<td>"+t.cssResultdata[e].no+"</td>",html+="<td>"+t.cssResultdata[e].projectName+"</td>",html+="<td>"+t.cssResultdata[e].customerComment+"</td>",html+="<td>"+t.cssResultdata[e].makeDateCss+"</td>",html+="<td>"+t.cssResultdata[e].cssPoint+"</td>",html+="</tr>";$("#danhsachdexuat tbody").html(html),$("#danhsachdexuat").parent().find(".pagination").html(t.paginationRender)}else $("#danhsachdexuat tbody").html(noResult),$("#danhsachdexuat").parent().find(".pagination").html("")}).fail(function(){alert("Ajax failed to fetch data")})}function removeEmptyCate(){var t=[],a=[];$("#question-choose option[data-type=question]").each(function(){t.push($(this).attr("parent-id"))}),$("#question-choose option[class=parent]").each(function(){if(jQuery.inArray($(this).attr("data-id"),t)!==-1){a.push($(this).attr("data-id"));var e=$(this).attr("parent-id");if($("#question-choose option[class=parent][data-id="+e+"]").length>0){a.push($(this).attr("parent-id"));var s=$("#question-choose option[class=parent][data-id="+e+"]"),d=s.attr("parent-id");$("#question-choose option[class=parent][data-id="+d+"]").length>0&&a.push(s.attr("parent-id"))}}}),$("#question-choose option[class=parent]").each(function(){jQuery.inArray($(this).attr("data-id"),a)==-1&&"overview"!==$(this).attr("data-type")&&$(this).remove()})}function getCriteriaType(t){switch(t){case"tcProjectType":criteriaType="projectType";break;case"tcTeam":criteriaType="team";break;case"tcPm":criteriaType="pm";break;case"tcBrse":criteriaType="brse";break;case"tcCustomer":criteriaType="customer";break;case"tcSale":criteriaType="sale";break;case"tcQuestion":criteriaType="question"}return criteriaType}function getDateDiff(t,a){var t=new Date(t),a=new Date(a),e=Math.abs(a.getTime()-t.getTime()),s=Math.ceil(e/864e5);return s}$("input").iCheck({checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue"}),$("#dateRanger").dateRangeSlider({range:{min:new Date(2016,0,1)},bounds:{min:new Date(2016,0,1),max:new Date(2017,11,31,12,59,59)},defaultValues:{min:new Date(2016,1,10),max:new Date(2017,4,22)}}),strLoading='<tr class="loading"><td colspan="7"><img class="loading-img" src="'+baseUrl+'sales/images/loading.gif" /></td></tr>',noResult='<tr><td colspan="7" style="text-align:center;">Không có kết quả nào được tìm thấy</td></tr>',$(document).on("icheck",function(){$("input").iCheck({checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue"});for(var t=["ProjectType","Team","Pm","Brse","Customer","Sale"],a=0;a<t.length;a++)$("#check"+t[a]).on("ifChecked",function(t){var a="."+$(this).attr("id")+"Item";$(a).iCheck("check"),triggeredByChild=!1}),$("#check"+t[a]).on("ifUnchecked",function(t){var a="."+$(this).attr("id")+"Item";triggeredByChild||$(a).iCheck("uncheck"),triggeredByChild=!1}),$(".check"+t[a]+"Item").on("ifUnchecked",function(t){triggeredByChild=!0;var a="#"+$(this).attr("class");a=a.replace("Item",""),$(a).iCheck("uncheck")}),$(".check"+t[a]+"Item").on("ifChecked",function(t){var a="#"+$(this).attr("class");a=a.replace("Item",""),$("."+$(this).attr("class")).filter(":checked").length==$("."+$(this).attr("class")).length&&$(a).iCheck("check")});$(".checkQuestionItem").on("ifChecked",function(t){var a=$(this).attr("data-id");$(".checkQuestionItem[parent-id="+a+"]").iCheck("check"),triggeredByChild=!1}),$(".checkQuestionItem").on("ifUnchecked",function(t){var a=$(this).attr("data-id");$(".checkQuestionItem[parent-id="+a+"]").iCheck("uncheck"),triggeredByChild=!1}),$("#tcProjectType").on("ifChecked",function(t){$(".tbl-criteria").hide(),$("table[data-id=tcProjectType]").show(),$(".no-result").hide(),$(".no-result-tcProjectType").show(),fixScroll($("table[data-id=tcProjectType] tbody"))}),$("#tcTeam").on("ifChecked",function(t){$(".tbl-criteria").hide(),$("table[data-id=tcTeam]").show(),$(".no-result").hide(),$(".no-result-tcTeam").show(),fixScroll($("table[data-id=tcTeam] tbody"))}),$("#tcPm").on("ifChecked",function(t){$(".tbl-criteria").hide(),$("table[data-id=tcPm]").show(),$(".no-result").hide(),$(".no-result-tcPm").show(),fixScroll($("table[data-id=tcPm] tbody"))}),$("#tcBrse").on("ifChecked",function(t){$(".tbl-criteria").hide(),$("table[data-id=tcBrse]").show(),$(".no-result").hide(),$(".no-result-tcBrse").show(),fixScroll($("table[data-id=tcBrse] tbody"))}),$("#tcCustomer").on("ifChecked",function(t){$(".tbl-criteria").hide(),$("table[data-id=tcCustomer]").show(),$(".no-result").hide(),$(".no-result-tcCustomer").show(),fixScroll($("table[data-id=tcCustomer] tbody"))}),$("#tcSale").on("ifChecked",function(t){$(".tbl-criteria").hide(),$("table[data-id=tcSale]").show(),$(".no-result").hide(),$(".no-result-tcSale").show(),fixScroll($("table[data-id=tcSale] tbody"))}),$("#tcQuestion").on("ifChecked",function(t){$(".tbl-criteria").hide(),$("table[data-id=tcQuestion]").show(),$(".no-result").hide(),$(".no-result-tcQuestion").show(),fixScroll($("table[data-id=tcProjectType] tbody"))})}).trigger("icheck"),$(document).ready(function(){$(".box-select-question #question-choose").change(function(){$(".box-select-question #question-choose option[value=0]").remove();var t=$(this).val();if(0==t)$("#duoi3sao tbody").html(""),$("#duoi3sao").parent().find(".pagination").html(""),$("#danhsachdexuat tbody").html(""),$("#danhsachdexuat").parent().find(".pagination").html("");else{var a=1,e=$("#question-choose option:selected").data("cssresult"),s=$("#question-choose option:selected").data("token");getListLessThreeStarByQuestion(t,a,s,e,"result_make","asc"),getProposesQuestion(t,a,s,e,"result_make","asc")}})});